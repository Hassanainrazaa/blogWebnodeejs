<!DOCTYPE html>
<html lang="en">

<head>
    <%- include("partials/head.ejs") %> <!-- Including the head partial -->
        <title>
            <%= blog.title %>
        </title>
</head>

<body class="text-wrap"> <!-- Apply text-wrap to the body to ensure wrapping -->
    <%- include("partials/navbar.ejs") %> <!-- Including the navbar partial -->

        <div class="container my-5">
            <!-- Display cover image at the top -->
            <div class="text-center">
                <img src="<%= blog.coverImageURL %>" alt="Blog Cover Image" class="img-fluid rounded mb-4"
                    style="max-width: 100%; height: auto;">
            </div>

            <!-- Blog title -->
            <h1 class="display-4 text-center mb-4">
                <%= blog.title %>
            </h1>

            <!-- Blog body -->
            <div class="blog-body">
                <pre class="bg-light p-3 rounded overflow-auto" style="white-space: pre-wrap; word-wrap: break-word;">
                <%= blog.body %> <!-- Blog text will preserve spaces and wrap properly here -->
            </pre>
            </div>

            <!-- Author information -->
            <div class="container mt-4">
                <div class="d-flex align-items-center mb-4">
                    <img src="<%= blog.createdBy.profileImageURL %>" width="50px" class="rounded-circle me-2"
                        alt="Author Image">
                    <strong>
                        <%= blog.createdBy.fullname %>
                    </strong>
                </div>

                <h2>Comments (<%= comments.length %>)</h2>


                <!-- Show comment form if the user is logged in -->
                <% if(locals.user) { %>
                    <form action="/blog/comment/<%= blog._id %>" method="post" class="mb-4">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="content" placeholder="Enter Your Comment">
                            <button class="btn btn-sm btn-primary mt-2" type="submit">Add</button>
                        </div>
                    </form>
                    <% } %>

                        <!-- Display Comments -->
                        <div class="comments-list">
                            <% comments.forEach(comment=> { %>
                                <div class="d-flex align-items-start mb-3 border-bottom pb-2">
                                    <img src="<%= comment.createdBy.profileImageURL %>" width="40px"
                                        class="rounded-circle me-2" alt="Commenter Image">
                                    <div>
                                        <strong>
                                            <%= comment.createdBy.fullname %>
                                        </strong>
                                        <p class="mb-1">
                                            <%= comment.content %>
                                        </p>
                                        <small class="text-muted">
                                            <%= new Date(comment.createdAt).toLocaleString() %>
                                        </small> <!-- Show comment date -->
                                    </div>
                                </div>
                                <% }); %>
                        </div>
            </div>
        </div>

        <%- include("partials/script.ejs") %> <!-- Including any additional scripts -->
</body>

</html>